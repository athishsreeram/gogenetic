package arch

import (
	"gogenetic/config"
	"gogenetic/gogexec"
	"gogenetic/gogfile"

	"gogenetic/data"

	"github.com/spf13/viper"
)

func LiquibaseLangArchConf(conf data.AutoGeneratedCli, dbType string) {

	var userTomlDir = conf.Gogenetic.TomlDir
	var userApiName = conf.API.Name
	var archTypes config.ArchTypes

	viper.Unmarshal(&archTypes)

	gogexec.MoveTo(conf.Gogenetic.Dir)

	for _, arch := range archTypes.ArchType {
		if dbType == arch.Name {
			for _, archPgt := range arch.Projects {
				for _, project := range archTypes.Projects {
					if archPgt == project.Name {

						if project.TemplateToml == "" {
							conf.Gogenetic.TomlDir = userTomlDir
						} else {
							conf.Gogenetic.TomlDir = project.TemplateToml
						}

						if project.ApiName == "" {
							conf.API.Name = userApiName
						} else {
							conf.API.Name = project.ApiName
						}

						for _, projectTpl := range project.Templates {
							gogfile.CreateFile(conf, project.TemplateBasePath+projectTpl, conf.Gogenetic.OutDir+project.OutputDir, "db")
						}

					}

				}
			}

			gogexec.MoveTo(conf.Gogenetic.Dir + "/" + conf.Gogenetic.OutDir)

		}

	}

}
